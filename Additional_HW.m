
x1 = 0
y1 = 0
x2 = 10 %Coordinates, code assumes a 2 member system
y2 = 20 
x3 = 35
y3 = 20
L1 = (sqrt((x2-x1)^2+(y2-y1)^2))*12
L2 = (sqrt((x3-x2)^2+(y3-y2)^2))*12
% 1 = Fixed, 0 = Pinned
Support1 = 1
Support2 = 0
z = (y2-y1)/(x2-x1)
a = atan(z)
z2 = (y3-y2)/(x3-x2)
b = atan(z2)
w = 2/12 %kip-in
%Q_f1 and Q_f2 are manual inputs

Q_f1 = [(w*sin(a)*L1)/2
    (w*cos(a)*L1)/2
    (w*cos(a)*L1^2)/12
    (w*sin(a)*L1)/2
    (w*cos(a)*L1)/2
    (-w*cos(a)*L1^2)/12]



Q_f2 = [
    0; 
    
    (7*w*L2)/20 + (3*1.5*w*L2)/20; 
    
    (3*w*L2^2)/60 + (2*1.5*w*L2^2)/60; 
    
    0; 
    
    ((w + 1.5*w)/2)*L2 - ((7*w*L2)/20 + (3*1.5*w*L2)/20); 
    
    (L2/6)*(w*(-2*L2) - 1.5*w*L2) + ((7*w*L2)/20 + (3*1.5*w*L2)/20)*L2 - ((3*w*L2^2)/60 + (2*1.5*w*L2^2)/60)
];

E = 29000 %ksi
A1 = 15 %in^2
A2 = 15 %in^2
I1 = 1000 %in^4
I2 = 1000 %in^4
L1 = (sqrt((x2-x1)^2+(y2-y1)^2))*12
L2 = (sqrt((x3-x2)^2+(y3-y2)^2))*12

k1 = [
    E*A1/L1,         0,                0,              -E*A1/L1,         0,                0;
    0,               12*E*I1/L1^3,     6*E*I1/L1^2,     0,               -12*E*I1/L1^3,     6*E*I1/L1^2;
    0,               6*E*I1/L1^2,      4*E*I1/L1,       0,               -6*E*I1/L1^2,      2*E*I1/L1;
    -E*A1/L1,        0,                0,               E*A1/L1,          0,                0;
    0,              -12*E*I1/L1^3,    -6*E*I1/L1^2,     0,                12*E*I1/L1^3,     -6*E*I1/L1^2;
    0,               6*E*I1/L1^2,      2*E*I1/L1,       0,               -6*E*I1/L1^2,      4*E*I1/L1
];


T1 = [
    cos(a),  sin(a),  0,       0,        0,       0;
   -sin(a),  cos(a),  0,       0,        0,       0;
    0,       0,       1,       0,        0,       0;
    0,       0,       0,      cos(a),   sin(a),   0;
    0,       0,       0,     -sin(a),   cos(a),   0;
    0,       0,       0,       0,        0,       1
];

K1 = T1^-1*k1*T1

F_f1 = T1^-1 * Q_f1

k2 = [
    E*A2/L2,          0,                 0,               -E*A2/L2,          0,                 0;
    0,                12*E*I2/L2^3,      6*E*I2/L2^2,      0,               -12*E*I2/L2^3,      6*E*I2/L2^2;
    0,                6*E*I2/L2^2,       4*E*I2/L2,        0,               -6*E*I2/L2^2,       2*E*I2/L2;
    -E*A2/L2,         0,                 0,                E*A2/L2,          0,                 0;
    0,               -12*E*I2/L2^3,     -6*E*I2/L2^2,      0,                12*E*I2/L2^3,      -6*E*I2/L2^2;
    0,                6*E*I2/L2^2,       2*E*I2/L2,        0,               -6*E*I2/L2^2,       4*E*I2/L2
];



T2 = [
    cos(b),  sin(b),  0,       0,        0,       0;
   -sin(b),  cos(b),  0,       0,        0,       0;
    0,       0,       1,       0,        0,       0;
    0,       0,       0,      cos(b),   sin(b),   0;
    0,       0,       0,     -sin(b),   cos(b),   0;
    0,       0,       0,       0,        0,       1
];

K2 = T2^-1 * k2 * T2;

F_f2 = T2^-1 * Q_f2

% Assuming Support1 and Support2 are already defined variables

if Support1 == 1 && Support2 == 1
    disp('Case 1: Both Supports are 1');
s = [
    K1(4,4) + K2(1,1),   K1(4,5) + K2(1,2),   K1(4,6) + K2(1,3);
    K1(5,4) + K2(2,1),   K1(5,5) + K2(2,2),   K1(5,6) + K2(2,3);
    K1(6,4) + K2(3,1),   K1(6,5) + K2(3,2),   K1(6,6) + K2(3,3)
];
P = [0
    0
    0]

P_f = [
    F_f1(4,1) + F_f2(1,1);
    F_f1(5,1)+F_f2(2,1);
F_f1(6,1)+F_f2(3,1);]

d = s^-1 * (P-P_f)

elseif Support1 == 1 && Support2 == 0
    disp('Case 2: Support1 is 1, Support2 is 0');

s = [
    K1(4,4) + K2(1,1),   K1(5,4) + K2(2,1),   K1(6,4) + K2(3,1),   K2(6,1);
    
    K1(4,5) + K2(1,2),   K1(5,5) + K2(2,2),   K1(6,5) + K2(3,2),   K2(6,2);
    
    K1(4,6) + K2(1,3),   K1(5,6) + K2(2,3),   K1(6,6) + K2(3,3),   K2(6,3);
    
    K2(1,6),             K2(2,6),             K2(3,6),             K2(6,6)
];
P = [0
    0
    0
    0]

P_f = [
    F_f1(4,1) + F_f2(1,1);
    F_f1(5,1)+F_f2(2,1);
F_f1(6,1)+F_f2(3,1);
F_f2(6,1);]
d = s^-1 * (P-P_f)

v1= [0;
    0;
    0;
    d(1,1);
    d(2,1);
    d(3,1);]
u1 = T1*v1
v2 = [d(1,1);
    d(2,1);
    d(3,1);
    0;
    0;
    d(4,1);]
u2 = T2*v2


else Support1 == 0 && Support2 == 1
    disp('Case 3: Support1 is 0, Support2 is 1');

s = [
    K1(3,3),            K1(3,4),                 K1(3,5),                 K1(3,6);
    
    K1(4,3),            K1(4,4) + K2(1,1),       K1(4,5) + K2(1,2),       K1(4,6) + K2(1,3);
    
    K1(5,3),            K1(5,4) + K2(2,1),       K1(5,5) + K2(2,2),       K1(5,6) + K2(2,3);
    
    K1(6,3),            K1(6,4) + K2(3,1),       K1(6,5) + K2(3,2),       K1(6,6) + K2(3,3)
];    
P_f = [
    F_f1(4,1) + F_f2(1,1);
    F_f1(5,1)+F_f2(2,1);
F_f1(6,1)+F_f2(3,1);
F_f2(6,1);]
d = s^-1 * (P-P_f)


end

Q1 = k1*u1 + Q_f1
F1 = T1^-1*Q1
Q2 = k2*u2 + Q_f2;
F2 = T2^-1*Q2;

R = [F1(1,1);
    F1(2,1);
    F1(3,1);
    F2(4,1);
    F2(5,1);]